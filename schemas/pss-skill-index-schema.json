{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PSS Skill Index",
  "description": "Global element index file for Perfect Skill Suggester, generated by /pss-reindex-skills. Indexes skills, agents, commands, rules, MCP servers, and LSP servers.",
  "version": "3.0",
  "type": "object",
  "required": ["version", "pass", "generated", "skills"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version (3.0 for two-pass architecture)",
      "const": "3.0"
    },
    "pass": {
      "type": "integer",
      "enum": [1, 2],
      "description": "Which pass generated this index: 1 = keywords only, 2 = with co-usage"
    },
    "generated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when this index was generated"
    },
    "generator": {
      "type": "string",
      "description": "Method used to generate the index",
      "enum": ["ai-analyzed", "manual", "hybrid"]
    },
    "skill_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of skills in the index"
    },
    "skills": {
      "type": "object",
      "description": "HashMap of skill name to skill entry (keyed by kebab-case skill name)",
      "additionalProperties": {
        "$ref": "#/definitions/SkillEntry"
      }
    }
  },
  "definitions": {
    "SkillEntry": {
      "type": "object",
      "description": "Individual skill entry in the index",
      "required": ["source", "path", "type", "keywords"],
      "properties": {
        "source": {
          "type": "string",
          "enum": ["user", "project", "plugin", "built-in"],
          "description": "Where the skill is installed"
        },
        "path": {
          "type": "string",
          "description": "Full path to source file (SKILL.md, agent.md, command.md, rule.md, or config reference)"
        },
        "type": {
          "type": "string",
          "enum": ["skill", "agent", "command", "rule", "mcp", "lsp"],
          "description": "Component type"
        },
        "description": {
          "type": "string",
          "description": "VERBATIM copy of the element's description from its source file"
        },
        "use_cases": {
          "type": "array",
          "items": { "type": "string" },
          "description": "VERBATIM list of use cases extracted from SKILL.md"
        },
        "category": {
          "type": "string",
          "description": "Primary category from pss-categories.json (e.g., 'web-frontend', 'devops-cicd'). Categories are FIELDS OF COMPETENCE/USAGE (web design, ML training, code optimization, etc.) - used to build the CxC co-usage frequency matrix. Must be one of the 16 predefined categories."
        },
        "secondary_categories": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Additional categories this skill belongs to. Categories are broader domains, not specific tools."
        },
        "keywords": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Flat array of lowercase keywords/phrases for rio v2.0 matching. Keywords are a SUPERSET of categories - they include category terms PLUS specific tools, names, actions, technologies (chrome, next.js, git, pytest, docker, setup, configure, etc.). Used for prompt matching, not for matrix building."
        },
        "intents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Action verbs: deploy, test, build, review, etc. (+4 points in scoring)"
        },
        "patterns": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Regex patterns for complex matching (+3 points)"
        },
        "directories": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Directory contexts where skill is relevant (+5 points)"
        },
        "path_patterns": {
          "type": "array",
          "items": { "type": "string" },
          "description": "File path patterns for matching"
        },
        "tier": {
          "type": "string",
          "enum": ["primary", "secondary", "specialized"],
          "default": "secondary",
          "description": "Skill tier for boost scoring: primary (+5), secondary (0), specialized (-2)"
        },
        "boost": {
          "type": "integer",
          "minimum": -10,
          "maximum": 10,
          "default": 0,
          "description": "Manual score adjustment"
        },
        "domain_gates": {
          "type": "object",
          "description": "Named keyword groups that act as hard prerequisite filters. ALL gates must have at least one keyword match in the user prompt, otherwise the skill is never suggested. Each key is a gate name (e.g., 'output_programming_language', 'input_language') and each value is an array of lowercase keywords/aliases. Example: a skill for Python-to-JavaScript transpilation would have gate 'input_language': ['python', 'py'] and gate 'output_language': ['javascript', 'js', 'typescript', 'ts']. If the user prompt does not mention any keyword from ANY gate, the skill is excluded. Use for skills with narrow applicability domains. Most generic skills should have an empty object {} or omit this field entirely.",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1,
            "description": "List of lowercase keywords/aliases for this domain gate. At least one must appear in the user prompt for the gate to pass."
          }
        },
        "server_type": {
          "type": "string",
          "enum": ["stdio", "sse"],
          "description": "MCP server transport type (additional metadata for type=mcp entries)"
        },
        "server_command": {
          "type": "string",
          "description": "MCP server launch command (additional metadata for type=mcp entries)"
        },
        "server_args": {
          "type": "array",
          "items": {"type": "string"},
          "description": "MCP server command arguments (additional metadata for type=mcp entries)"
        },
        "language_ids": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Programming language IDs served by this LSP (additional metadata for type=lsp entries)"
        },
        "co_usage": {
          "$ref": "#/definitions/CoUsage",
          "description": "Co-usage information generated by Pass 2 agents"
        }
      }
    },
    "CoUsage": {
      "type": "object",
      "description": "Co-usage relationships determined by Pass 2 AI analysis",
      "properties": {
        "usually_with": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Skills typically used together in the SAME session/task"
        },
        "precedes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Skills typically used BEFORE this skill (this skill follows them)"
        },
        "follows": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Skills typically used AFTER this skill (they follow this skill)"
        },
        "alternatives": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Alternative skills that solve the SAME problem differently"
        },
        "rationale": {
          "type": "string",
          "description": "AI-generated brief explanation of why these co-usage relationships exist"
        }
      }
    }
  },
  "examples": [
    {
      "version": "3.0",
      "pass": 2,
      "generated": "2026-01-19T12:00:00Z",
      "generator": "ai-analyzed",
      "skill_count": 245,
      "skills": {
        "github-workflow": {
          "source": "user",
          "path": "/Users/user/.claude/skills/github-workflow/SKILL.md",
          "type": "skill",
          "description": "GitHub workflow using gh CLI - create issues with duplicate checking and labels, create PRs with CI/CD monitoring, link issues to PRs, squash-merge to main.",
          "use_cases": [
            "Creating GitHub issues",
            "Opening pull requests",
            "Merging PRs to main",
            "Managing GitHub workflow"
          ],
          "category": "devops-cicd",
          "keywords": ["github", "gh cli", "pull request", "pr", "issue", "merge", "squash", "ci/cd", "workflow"],
          "intents": ["create", "merge", "open", "link"],
          "domain_gates": {},
          "tier": "primary",
          "boost": 0,
          "co_usage": {
            "usually_with": ["git-workflow", "commit"],
            "precedes": ["commit"],
            "follows": ["git-workflow"],
            "alternatives": [],
            "rationale": "GitHub workflow typically follows local git workflow and precedes commits, as PRs are created after local changes are ready."
          }
        }
      }
    }
  ]
}
