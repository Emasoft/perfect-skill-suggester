{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PSS Agent TOML Configuration",
  "description": "Schema for .agent.toml files generated by /pss-setup-agent. Defines the recommended skills, complementary agents, and metadata for a profiled agent.",
  "version": "1.0",
  "type": "object",
  "required": ["agent", "skills"],
  "properties": {
    "agent": {
      "type": "object",
      "description": "Agent identification and source metadata",
      "required": ["name", "path"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Agent name (kebab-case, e.g., 'security-auditor')",
          "pattern": "^[a-z0-9][a-z0-9_-]*$"
        },
        "source": {
          "type": "string",
          "description": "How the agent was specified: 'path' for direct file path, 'plugin:<name>' for plugin notation",
          "pattern": "^(path|plugin:[a-z0-9][a-z0-9_-]*)$",
          "examples": ["path", "plugin:my-plugin"]
        },
        "path": {
          "type": "string",
          "description": "Absolute path to the <agent-name>.md definition file"
        }
      },
      "additionalProperties": false
    },
    "requirements": {
      "type": "object",
      "description": "Design requirements context used for profiling (empty if none provided)",
      "properties": {
        "files": {
          "type": "array",
          "description": "Basenames of requirement files used for profiling",
          "items": { "type": "string" },
          "default": []
        },
        "project_type": {
          "type": "string",
          "description": "Detected project type from requirements (e.g., 'web-app', 'cli-tool', 'mobile-app', 'library')",
          "default": ""
        },
        "tech_stack": {
          "type": "array",
          "description": "Key technologies detected from requirements",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "skills": {
      "type": "object",
      "description": "Tiered skill recommendations, ordered by relevance within each tier",
      "required": ["primary", "secondary", "specialized"],
      "properties": {
        "primary": {
          "type": "array",
          "description": "Core skills the agent needs for daily work (min 1, max 7). Score >= 60% of max.",
          "items": { "type": "string" },
          "minItems": 1,
          "maxItems": 7,
          "uniqueItems": true
        },
        "secondary": {
          "type": "array",
          "description": "Useful skills for common tasks (max 12). Score 30-59% of max.",
          "items": { "type": "string" },
          "maxItems": 12,
          "uniqueItems": true
        },
        "specialized": {
          "type": "array",
          "description": "Niche skills for specific situations (max 8). Score 15-29% of max.",
          "items": { "type": "string" },
          "maxItems": 8,
          "uniqueItems": true
        },
        "excluded": {
          "type": "object",
          "description": "Skills considered but excluded. Keys are skill names, values are exclusion reasons. Stored as TOML comments in the file (not parsed, for human reference).",
          "additionalProperties": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "agents": {
      "type": "object",
      "description": "Complementary agents that work well with this one",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "Agent names that complement this agent's workflow",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "commands": {
      "type": "object",
      "description": "Recommended slash commands for this agent",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "Command names that enhance this agent's workflow",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type": "object",
      "description": "Rules that should be active when this agent runs",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "Rule names that enforce quality constraints for this agent",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "mcp": {
      "type": "object",
      "description": "MCP servers that enhance this agent's capabilities",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "MCP server names that enhance this agent's capabilities",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "hooks": {
      "type": "object",
      "description": "Hooks relevant to this agent's workflow",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "Hook configurations relevant to this agent's workflow",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "lsp": {
      "type": "object",
      "description": "LSP servers relevant to this agent",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "LSP server names for languages this agent works with",
          "items": { "type": "string" },
          "default": []
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,

  "examples": [
    {
      "agent": {
        "name": "security-auditor",
        "source": "path",
        "path": "/path/to/agents/security-auditor.md"
      },
      "requirements": {
        "files": ["prd.md", "tech-spec.md"],
        "project_type": "web-app",
        "tech_stack": ["python", "django", "postgresql"]
      },
      "skills": {
        "primary": ["security", "aegis", "code-review"],
        "secondary": ["exhaustive-testing", "dead-code", "debug-hooks"],
        "specialized": ["tdd", "profiler"],
        "excluded": {}
      },
      "agents": {
        "recommended": ["sleuth", "e2e-tester"]
      },
      "commands": { "recommended": ["pss-reindex-skills"] },
      "rules": { "recommended": ["claim-verification"] },
      "mcp": { "recommended": ["chrome-devtools"] },
      "hooks": { "recommended": [] },
      "lsp": { "recommended": ["pyright-lsp"] }
    },
    {
      "agent": {
        "name": "frontend-developer",
        "source": "plugin:multi-platform-apps",
        "path": "~/.claude/plugins/cache/abc/multi-platform-apps/1.0/agents/frontend-developer.md"
      },
      "requirements": {
        "files": ["prd.md", "design-system.md"],
        "project_type": "web-app",
        "tech_stack": ["typescript", "react", "nextjs", "tailwind", "postgresql"]
      },
      "skills": {
        "primary": ["building-with-bun", "css-to-svg-conversion", "development-standards"],
        "secondary": ["exhaustive-testing", "handle-deprecation-warnings", "dependency-management", "git-workflow"],
        "specialized": ["accessibility-compliance", "responsive-design"],
        "excluded": {
          "vue-frontend": "Excluded: conflicts with React (requirements specify React/Next.js)",
          "angular-dev": "Excluded: conflicts with React (requirements specify React/Next.js)"
        }
      },
      "agents": {
        "recommended": ["ui-ux-designer", "e2e-tester"]
      },
      "commands": { "recommended": ["commit", "describe-pr"] },
      "rules": { "recommended": ["claim-verification", "observe-before-editing"] },
      "mcp": { "recommended": ["chrome-devtools"] },
      "hooks": { "recommended": [] },
      "lsp": { "recommended": ["typescript-lsp"] }
    }
  ]
}
